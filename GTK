import gi
import subprocess
from gi.repository import Gtk, Gdk

gi.require_version('Gtk', '3.0')

def main():
    try:
        # Load the Glade file
        builder = Gtk.Builder()
        builder.add_from_file("/home/operator/tmc/python/images/tormach_mill_ui.glade")
        
        # Get the main window and drawing area
        window = builder.get_object("main_window")
        drawing_area = builder.get_object("drawingarea1")
        
        # List of widget names to skip
        skip_widgets = ["gtk_source_view_widget_name"]  # Replace with actual GtkSourceView widget names

        # Check if the widget name is in the skip list
        def should_skip(widget):
            widget_name = widget.get_name()
            return widget_name in skip_widgets
        
        # Example of accessing the drawing area and its properties
        if drawing_area is not None and drawing_area.get_window() is not None:
            xid = drawing_area.get_window().get_xid()
            
            # Run mplayer with the XID embedded in the drawing area
            command = "mplayer tv:// -tv driver=v4l2:device=/dev/video0 -wid {}".format(xid)
            subprocess.Popen(command, shell=True)
        else:
            print("Drawing area or its window is not available.")
        
        # Show the window
        window.show_all()
        
        # Start the GTK main loop
        Gtk.main()
    
    except Exception as e:
        print("An error occurred: {}".format(e))
        # General error handling
        print("Please check the Glade file and widget names.")

if __name__ == "__main__":
    main()
